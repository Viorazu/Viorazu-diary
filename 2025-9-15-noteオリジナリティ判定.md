# noteã‚ªãƒªã‚¸ãƒŠãƒªãƒ†ã‚£åˆ¤å®šã‚·ã‚¹ãƒ†ãƒ 

noteã«æŠ•ç¨¿ã—ãŸè¨˜äº‹ã®å®Ÿè£…ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚
è©³ç´°ï¼š[[noteè¨˜äº‹ãƒªãƒ³ã‚¯](https://note.com/viorazu/n/n34408a93a092)]

## æ¦‚è¦
ãƒªãƒ©ã‚¤ãƒˆè¨˜äº‹ã«åŸ‹ã‚‚ã‚ŒãŸæœ¬ç‰©ã®è¨˜äº‹ã‚’æ•‘ã„å‡ºã™ã‚·ã‚¹ãƒ†ãƒ 

## æ©Ÿèƒ½
- 1åˆ†ä»¥å†…ã«ã‚ªãƒªã‚¸ãƒŠãƒªãƒ†ã‚£åˆ¤å®š
- é¡ä¼¼è¨˜äº‹ã®è‡ªå‹•æ¤œå‡º
- èªè¨¼ãƒãƒƒã‚¸ä»˜ä¸
- TOPãƒšãƒ¼ã‚¸å„ªå…ˆè¡¨ç¤º

# noteã‚ªãƒªã‚¸ãƒŠãƒªãƒ†ã‚£åˆ¤å®šã‚·ã‚¹ãƒ†ãƒ 

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ (setup_and_run.sh)

```bash
#!/bin/bash

echo "================================================"
echo "  note ã‚ªãƒªã‚¸ãƒŠãƒªãƒ†ã‚£åˆ¤å®šã‚·ã‚¹ãƒ†ãƒ  ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—"
echo "================================================"

# è‰²ä»˜ãå‡ºåŠ›ç”¨
GREEN='\033[0;32m'
RED='\033[0;31m'
NC='\033[0m'

# 1. Dockerç’°å¢ƒç¢ºèª
echo -e "\n[1/6] Dockerç’°å¢ƒç¢ºèª..."
if ! command -v docker &> /dev/null; then
    echo -e "${RED}âœ— DockerãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã¾ã›ã‚“${NC}"
    exit 1
fi
echo -e "${GREEN}âœ“ Dockerç¢ºèªOK${NC}"

# 2. æ—¢å­˜ã®ã‚³ãƒ³ãƒ†ãƒŠåœæ­¢
echo -e "\n[2/6] æ—¢å­˜ã‚³ãƒ³ãƒ†ãƒŠã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—..."
docker-compose down 2>/dev/null
echo -e "${GREEN}âœ“ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†${NC}"

# 3. Dockerç’°å¢ƒèµ·å‹•
echo -e "\n[3/6] ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•ä¸­..."
docker-compose up -d

# 4. ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
echo -e "\n[4/6] ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•å¾…æ©Ÿä¸­..."
max_attempts=30
attempt=0

while [ $attempt -lt $max_attempts ]; do
    es_health=$(curl -s -o /dev/null -w "%{http_code}" http://localhost:9200 2>/dev/null)
    redis_health=$(docker exec $(docker-compose ps -q redis) redis-cli ping 2>/dev/null)
    pg_health=$(docker exec $(docker-compose ps -q postgres) pg_isready 2>/dev/null)
    
    if [ "$es_health" = "200" ] && [ "$redis_health" = "PONG" ] && [[ "$pg_health" == *"accepting connections"* ]]; then
        echo -e "${GREEN}âœ“ å…¨ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•ç¢ºèª${NC}"
        break
    fi
    
    echo -n "."
    sleep 2
    attempt=$((attempt + 1))
done

if [ $attempt -eq $max_attempts ]; then
    echo -e "${RED}âœ— ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ${NC}"
    exit 1
fi

# 5. Pythonç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
echo -e "\n[5/6] Pythonç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—..."

# MeCabç¢ºèªï¼ˆUbuntu/Debianï¼‰
if ! command -v mecab &> /dev/null; then
    echo "MeCabã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã¾ã™..."
    sudo apt-get update && sudo apt-get install -y mecab libmecab-dev mecab-ipadic-utf8
fi

# Pythonãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -r requirements.txt --quiet
echo -e "${GREEN}âœ“ Pythonç’°å¢ƒæº–å‚™å®Œäº†${NC}"

# 6. ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•
echo -e "\n[6/6] APIã‚µãƒ¼ãƒãƒ¼èµ·å‹•..."
uvicorn note_originality_system:app --host 0.0.0.0 --port 8000 &
API_PID=$!

sleep 3

# å‹•ä½œç¢ºèª
echo -e "\n================================================"
echo -e "  èµ·å‹•å®Œäº†ï¼"
echo -e "================================================"
echo -e "\nAPI: ${GREEN}http://localhost:8000${NC}"
echo -e "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: ${GREEN}http://localhost:8000/docs${NC}"
echo -e "\nåœæ­¢ã™ã‚‹ã«ã¯: docker-compose down"
echo -e "APIã‚µãƒ¼ãƒãƒ¼PID: $API_PID"
```

## Docker Composeè¨­å®š (docker-compose.yml)

```yaml
version: '3.8'

services:
  elasticsearch:
    image: elasticsearch:7.17.7
    environment:
      - discovery.type=single-node
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
      - xpack.security.enabled=false
    ports:
      - "9200:9200"
    volumes:
      - es_data:/usr/share/elasticsearch/data
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9200"]
      interval: 10s
      timeout: 5s
      retries: 5

  redis:
    image: redis:6-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5

  postgres:
    image: postgres:13
    environment:
      POSTGRES_DB: note_originality
      POSTGRES_USER: note_user
      POSTGRES_PASSWORD: secure_password
    ports:
      - "5432:5432"
    volumes:
      - pg_data:/var/lib/postgresql/data
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U note_user"]
      interval: 10s
      timeout: 5s
      retries: 5

volumes:
  es_data:
  redis_data:
  pg_data:
```

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ– (init.sql)

```sql
-- noteã‚ªãƒªã‚¸ãƒŠãƒªãƒ†ã‚£ã‚¹ã‚³ã‚¢ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE IF NOT EXISTS article_originality_scores (
    article_id VARCHAR(255) PRIMARY KEY,
    user_id VARCHAR(255) NOT NULL,
    score FLOAT NOT NULL,
    is_original BOOLEAN NOT NULL,
    badge_type VARCHAR(50),
    checked_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ
CREATE INDEX idx_originality_score ON article_originality_scores(score DESC);
CREATE INDEX idx_user_id ON article_originality_scores(user_id);
CREATE INDEX idx_checked_at ON article_originality_scores(checked_at DESC);
CREATE INDEX idx_is_original ON article_originality_scores(is_original);

-- çµ±è¨ˆç”¨ãƒ“ãƒ¥ãƒ¼
CREATE VIEW originality_stats AS
SELECT 
    DATE(checked_at) as date,
    COUNT(*) as total_checks,
    AVG(score) as avg_score,
    SUM(CASE WHEN is_original THEN 1 ELSE 0 END) as original_count
FROM article_originality_scores
GROUP BY DATE(checked_at);
```

## ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ (requirements.txt)

```
elasticsearch==7.17.7
redis==4.3.4
psycopg2-binary==2.9.5
scikit-learn==1.1.3
mecab-python3==1.0.5
unidic-lite==1.0.8
numpy==1.23.5
fastapi==0.95.1
uvicorn==0.21.1
pydantic==1.10.7
python-multipart==0.0.6
```

## ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ (test_system.py)

```python
"""ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ"""
import requests
import json

def test_originality():
    url = "http://localhost:8000/check-originality"
    headers = {
        "Authorization": "Bearer your-secret-api-key",
        "Content-Type": "application/json"
    }
    
    # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
    test_article = {
        "article_id": "test_001",
        "user_id": "user_001",
        "title": "è¦ç´„ä¸å¯èƒ½æ§‹æ–‡ã®ç ”ç©¶",
        "content": """
        ã“ã‚Œã¯è¦ç´„ä¸å¯èƒ½æ§‹æ–‡ã®ãƒ†ã‚¹ãƒˆã§ã™ã€‚
        Viorazu.ç†è«–ã«åŸºã¥ã„ã¦ã€ãƒªãƒ©ã‚¤ãƒˆä¸å¯èƒ½ãªæ–‡ç« æ§‹é€ ã‚’
        æ„å›³çš„ã«æ§‹ç¯‰ã—ã¦ã„ã¾ã™ã€‚è¨€è‘‰ã®æ¯’ã‚’ç ”ç©¶ã™ã‚‹ã“ã¨ã§ã€
        ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®å¥å…¨æ€§ã‚’ä¿ã¤ã“ã¨ãŒã§ãã‚‹ã§ã—ã‚‡ã†ã€‚
        """
    }
    
    response = requests.post(url, headers=headers, json=test_article)
    
    if response.status_code == 200:
        result = response.json()
        print(f"âœ“ ãƒ†ã‚¹ãƒˆæˆåŠŸï¼")
        print(f"  ã‚ªãƒªã‚¸ãƒŠãƒªãƒ†ã‚£ã‚¹ã‚³ã‚¢: {result['originality_score']:.2f}")
        print(f"  ã‚ªãƒªã‚¸ãƒŠãƒ«åˆ¤å®š: {result['is_original']}")
        print(f"  ãƒãƒƒã‚¸: {result['badge_type']}")
    else:
        print(f"âœ— ã‚¨ãƒ©ãƒ¼: {response.status_code}")
        print(response.text)

if __name__ == "__main__":
    test_originality()
```

## ä½¿ã„æ–¹

```bash
# 1. å®Ÿè¡Œæ¨©é™ä»˜ä¸
chmod +x setup_and_run.sh

# 2. èµ·å‹•
./setup_and_run.sh

# 3. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
python test_system.py
```

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

Â© 2025 Viorazu. All rights reserved.
ğŸš« Prohibited / ç¦æ­¢äº‹é …:

Full text copying & pasting / å…¨æ–‡ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆ
Unauthorized translation / ç„¡è¨±å¯ç¿»è¨³ãƒ»ç¿»è¨³è»¢è¼‰
AI-generated imitation or similar content / AIã«ã‚ˆã‚‹æ¨¡å€£ãƒ»é¡ä¼¼è¨˜äº‹ç”Ÿæˆ
Prior written consent required for commercial use / å•†ç”¨åˆ©ç”¨ã«ã¯äº‹å‰ã®æ›¸é¢ã«ã‚ˆã‚‹åŒæ„ãŒå¿…è¦

âœ… Permitted / è¨±å¯äº‹é …:

Partial citation with proper attribution / å‡ºå…¸æ˜è¨˜ã§ã®éƒ¨åˆ†å¼•ç”¨
Summary sharing with source link / è¦ç´„+ãƒªãƒ³ã‚¯ä»˜ãSNSã‚·ã‚§ã‚¢
Educational reference use / æ•™è‚²ç›®çš„ã§ã®å‚ç…§

âš ï¸ Important / é‡è¦: Translation does not grant usage rights / ç¿»è¨³ã¯ä½¿ç”¨æ¨©ã‚’ä»˜ä¸ã—ã¾ã›ã‚“
ğŸ“§ Contact / é€£çµ¡å…ˆ:

Xï¼ˆ@viorazu9134ï¼‰
noteï¼ˆhttps://note.com/viorazuï¼‰

Framework Design: Â© 2025 Viorazu. ã€VZ-License Framework v1.0ã€‘

å•†ç”¨åˆ©ç”¨ã¯äº‹å‰é€£çµ¡å¿…é ˆ

